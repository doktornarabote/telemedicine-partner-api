# Рекомендации по использованию API

## Реализация чата для текстовой консультации

В качестве количества сообщений для интервального обновления по умолчанию рекомендуется использовать значения **от 5 до 10**.

1. Получение первого непрочитанного сообщения.
	1. [Получение списка непрочитанных сообщений](./messages.md#Получение-списка-непрочитанных-сообщений) с параметрами `limit=1`, `offset=0`.
	2. Вставить сообщение в чат.
	3. Сохранить `totalCount` из ответа.
2. Получение всех последующих сообщений, включая свои. (**Пропустить этот шаг, если нет непрочитанных сообщений!**)
	1. [Получение списка сообщений](./messages.md#Получение-списка-сообщений) с параметрами:
		- `limit=unreadTotalCount+defaultLimit`, где `unreadTotalCount` - запомненное значение в п.1.3., `defaultLimit` - количество сообщений для интервального обновления по умолчанию;
		- `offset=0`;
		- `createdFromUtc=$date`, где `$date` - дата непрочитанного сообщения;
		- `lookforward=true`;
	2. Вставить полученные сообщения в конец чата последовательно, начиная с начала массива из ответа.
	3. [Обозначить непрочитанные сообщения как прочитанные](./messages.md#Пометить-сообщения-как-прочитанные).
3. Получение предыдущих сообщений.
	1. [Получение списка сообщений](./messages.md#Получение-списка-сообщений) с параметрами:
		- `limit=defaultLimit`, `defaultLimit` - количество сообщений для интервального обновления по умолчанию;
		- `offset=0`;
		- `createdFromUtc=$date`, где `$date` - дата самого старого сообщения, которое удалось получить при выполнении предыдущих пунктов (т.е. среди имеющихся), иначе параметр не указывать;
		- `lookforward=false`, если указан параметр `createdFromUtc`;
	2. Вставить полученные сообщения в начало чата последовательно, начиная с конца массива из ответа.
4. Периодическая проверка наличия новых сообщений.
	1. [Получение списка сообщений](./messages.md#Получение-списка-сообщений) с параметрами:
		- `limit=defaultLimit`, `defaultLimit` - количество сообщений для интервального обновления по умолчанию;
		- `offset=0`;
		- `createdFromUtc=$date`, где `$date` - дата самого старого сообщения, которое удалось получить при выполнении предыдущих пунктов (т.е. среди имеющихся), иначе параметр не указывать;
		- `lookforward=true`, если указан параметр `createdFromUtc`;
	2. Вставить полученные сообщения в конец чата последовательно, начиная с начала массива из ответа.
	3. [Обозначить непрочитанные сообщения как прочитанные](./messages.md#Пометить-сообщения-как-прочитанные).
5. Подгрузка истории.
	1. При скроллинге вверх начинать подгружать историю сообщений аналогично п.3.
